Git 파일 상태 관리: diff, rm, restore 핵심 정리

서론: Git 파일 관리의 중요성

Git을 사용한 효과적인 프로젝트 관리는 작업 디렉토리(Working Directory), 스테이징 영역(Staging Area), 그리고 Git 저장소(Repository)라는 세 가지 핵심 영역에 걸친 파일의 상태를 정확히 이해하고 조작하는 능력에 달려 있습니다. 각 영역의 역할을 파악하고 파일 상태를 자유자재로 제어할 수 있을 때, 비로소 Git의 강력한 버전 관리 기능을 온전히 활용할 수 있습니다.

본 문서는 변경 사항을 비교하는 diff, 파일을 추적에서 제외하거나 완전히 삭제하는 rm, 그리고 이전 상태로 되돌리는 restore 명령어의 필수 기능을 종합적으로 검토하는 가이드입니다. 이 세 가지 명령어는 Git 파일 관리의 핵심 축을 이루며, 프로젝트의 이력을 깨끗하고 의도한 대로 유지하는 데 결정적인 역할을 합니다.

이 명령어들을 이해하기 위한 첫걸음은 모든 작업의 기반이 되는 Git의 세 가지 핵심 영역을 파악하는 것입니다.

1. Git의 3가지 핵심 영역: 작업의 기반 이해하기

모든 Git 명령어는 세 가지의 독립된 영역 중 특정 영역을 대상으로 작동합니다. 따라서 각 영역의 고유한 역할과 목적을 이해하는 것은 Git을 마스터하기 위한 가장 중요하고 기본적인 단계입니다. 이 세 영역 간의 상호작용을 파악하면, 이후에 다룰 명령어들의 작동 원리를 훨씬 명확하게 이해할 수 있습니다.

영역 (Area)	                                별칭 (Aliases)	                            핵심 역할 및 특징 (Core Role & Characteristics)
작업 디렉토리 (Working Directory)          	Working Folder, Working Tree	    PC 탐색기에서 직접 보고 수정하는 실제 파일들이 위치한 공간입니다.
스테이징 영역 (Staging Area)	                      Index	                      커밋할 변경사항을 선별하여 임시로 보관하는 준비 공간입니다. git add 명령으로 파일을 추가합니다.
깃 (지역) 저장소 (Git Repository)	          Last commit, HEAD                	프로젝트의 모든 버전 이력(커밋)이 .git 폴더 내에 영구적으로 저장되는 공간입니다.

이어지는 섹션에서는 이 세 영역 사이에서 파일의 상태를 비교하고 이동시키는 구체적인 명령어들을 자세히 살펴보겠습니다.

2. 변경 사항 추적 및 비교: git diff

git diff는 Git의 여러 영역에 존재하는 파일 상태 간의 차이점이나 서로 다른 커밋 간의 변경 내용을 정밀하게 확인할 수 있는 핵심 도구입니다. 이 명령어를 통해 변경 사항을 스테이징하거나 커밋하기 전에 미리 검토함으로써, 의도치 않은 변경이 프로젝트 이력에 포함되는 것을 방지할 수 있습니다.

2.1. 작업 디렉토리 vs. 스테이징 영역 비교

이 비교는 스테이징되지 않은(unstaged) 변경 사항, 즉 마지막으로 git add를 실행한 이후 작업 디렉토리에서 수정된 내용을 확인하는 데 사용됩니다.

* 명령어:
* 핵심:

2.2. 스테이징 영역 vs. 깃 저장소 (HEAD) 비교

이 비교는 다음 커밋에 포함될 예정인 스테이징된(staged) 변경 사항을 확인하는 데 사용됩니다.

* 명령어:
* 참고: --cached 별칭으로도 사용할 수 있습니다.
* 핵심:

2.3. 작업 디렉토리 vs. 깃 저장소 (HEAD) 비교

이 비교는 마지막 커밋 이후 발생한 모든 변경 사항(스테이징된 것과 그렇지 않은 것 모두)을 종합적으로 보여줍니다.

* 명령어:
* 핵심:

2.4. 커밋 간의 비교

프로젝트 이력의 특정 두 지점을 비교하여 시간의 흐름에 따른 변화를 분석할 수 있습니다.

* 주요 명령어:
  * $ git diff HEAD~ HEAD: 이전 커밋과 최신 커밋(HEAD)을 비교합니다.
  * $ git diff HEAD~2 HEAD: 2단계 이전 커밋과 최신 커밋(HEAD)을 비교합니다.
  * $ git diff [commit ID 1] [commit ID 2]: 특정 두 커밋 ID를 지정하여 비교합니다.
* HEAD 포인터 설명:
  * HEAD~ 또는 HEAD^는 HEAD로부터 1단계 이전 커밋을 가리킵니다.
  * HEAD~2 또는 HEAD^^는 HEAD로부터 2단계 이전 커밋을 가리킵니다.

diff가 변경 사항을 확인하는 도구라면, rm과 restore는 이러한 변경 사항을 적극적으로 관리하고 되돌리는 데 사용되는 명령어입니다.

3. 파일 삭제: git rm

Git 저장소에서 파일을 삭제할 때는 단순히 운영체제의 삭제 기능을 사용하는 것만으로는 부족합니다. 변경 사항이 프로젝트 이력에 올바르게 기록되도록 Git에 파일이 삭제되었음을 명시적으로 알려주어야 합니다. git rm 명령어는 이 과정을 체계적으로 처리합니다.

명령어 (Command)	                         영향 범위 (Scope of Impact)                        	핵심 설명 (Key Description)
rm [file]	                      작업 디렉토리만 (Working Directory only)	              단순 리눅스 파일 삭제. Git은 이 변경을 "삭제"로 인식하지 않고, 단지 파일이 사라진 것으로 간주하여 스테이징 영역과 불일치가 발생합니다.
git rm [file]	                  작업 디렉토리 + 스테이징 영역 (WD + Staging Area)	      가장 일반적인 Git 삭제 방법. 실제 파일을 삭제하고, 해당 삭제 이력을 스테이징하여 다음 커밋에 반영합니다.
git rm --cached [file]          스테이징 영역만 (Staging Area only)	                  파일 추적을 중단시킬 때 사용합니다. 작업 디렉토리의 파일은 그대로 유지하면서, 스테이징 영역에서만 파일을 제거하여 Git이 더 이상 관리하지 않도록 합니다 (Untracked 상태로 전환).

파일을 삭제할 수 있는 것처럼, Git은 삭제되거나 변경된 파일을 이전 상태로 되돌릴 수 있는 강력한 복원 도구를 제공합니다.

4. 파일 상태 되돌리기: git restore

git restore는 작업 디렉토리와 스테이징 영역의 변경 사항을 안전하고 직관적으로 되돌릴 수 있는 다목적 명령어입니다. 원치 않는 수정을 폐기하거나, 스테이징을 취소하거나, 저장소의 특정 버전으로 파일을 복원하는 데 유용하게 사용됩니다.

* $ git restore [file]
  * 목적: 스테이징 영역의 상태를 작업 디렉토리로 복원. 작업 디렉토리에서 수정한 내용을 버리고, 가장 최근에 git add 했던 버전으로 되돌립니다.
  * ⚠️ 주의: 작업 디렉토리에서 스테이징하지 않은(unstaged) 변경 내용이 영구적으로 사라지므로 신중하게 사용해야 합니다.
* $ git restore --staged [file]
  * 목적: 깃 저장소(HEAD)의 상태를 스테이징 영역으로 복원. git add를 취소(unstage)하고 싶을 때 사용합니다. 스테이징 영역의 파일이 최신 커밋 버전으로 되돌아갑니다.
* $ git restore --source=HEAD [file]
  * 목적: 깃 저장소(HEAD)의 상태를 작업 디렉토리로 복원. 스테이징 영역은 그대로 둔 채, 작업 디렉토리의 파일을 최신 커밋 버전으로 덮어씁니다. (--worktree 옵션은 기본값이므로 생략 가능합니다.)
  * ⚠️ 주의: 이 명령 또한 작업 디렉토리의 파일을 덮어쓰므로, 스테이징하지 않은 변경 내용이 영구적으로 사라질 수 있습니다.
* $ git restore --source=HEAD --staged --worktree [file]
  * 목적: 깃 저장소(HEAD)의 상태를 작업 디렉토리와 스테이징 영역 모두에 한번에 복원. 모든 변경사항(staged, unstaged)을 버리고 최신 커밋 상태로 완전히 되돌립니다.
  * ⚠️ 주의: 작업 디렉토리와 스테이징 영역의 모든 변경 내용이 영구적으로 사라지므로, 실행 전 변경 사항을 다시 한번 확인해야 합니다.

💡 이전 버전으로 복원하기 --source=HEAD~와 같이 커밋을 지정하면, 현재 커밋이 아닌 더 이전 커밋의 파일 내용으로도 작업 디렉토리나 스테이징 영역을 복원할 수 있습니다.

지금까지 다룬 핵심 명령어들을 빠르게 찾아볼 수 있도록 마지막 섹션에서 요약표를 제공합니다.

5. 핵심 명령어 요약표

이 섹션은 본문에서 다룬 주요 명령어와 그 핵심 기능을 한눈에 파악할 수 있도록 정리한 빠른 참조 가이드입니다. 필요할 때 신속하게 원하는 명령어를 찾아 활용하는 데 도움이 될 것입니다.

명령어 (Command)	                            핵심 기능 (Core Function)
git diff	                          작업 디렉토리와 스테이징 영역 비교 (Unstaged 변경사항 확인)
git diff --staged	                  스테이징 영역과 깃 저장소(HEAD) 비교 (Staged 변경사항 확인)
git diff HEAD                      	작업 디렉토리와 깃 저장소(HEAD) 비교 (모든 변경사항 확인)
git diff [commit1] [commit2]      	두 커밋 간의 차이 비교
git rm [file]	                      작업 디렉토리와 스테이징 영역에서 파일 삭제
git rm --cached [file]	            스테이징 영역에서만 파일 삭제 (파일 추적 중단)
git restore [file]	                스테이징 영역의 내용으로 작업 디렉토리 덮어쓰기
git restore --staged [file]        	HEAD의 내용으로 스테이징 영역 덮어쓰기 (add 취소)
git restore --source=HEAD	          HEAD의 내용으로 작업 디렉토리와 스테이징 영역 모두 복원
--staged --worktree [file]	
